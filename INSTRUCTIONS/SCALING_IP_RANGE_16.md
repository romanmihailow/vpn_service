# SCALING_IP_RANGE_16

## 1) Что было
- Использование подсети 10.8.0.0/24.
- Линейный перебор IP в формате 10.8.0.X.
- Ограничение по количеству клиентов в пределах /24.

## 2) Что изменено
- Переход на подсеть 10.8.0.0/16 выполнен только на уровне генерации IP в коде, без изменения существующих данных.
- Выдача IP через `ip_network(...).hosts()`.
- Явное исключение серверного IP (10.8.0.1).
- Advisory-lock и file-lock оставлены без изменений.

## 3) Что НЕ менялось
- Бизнес-логика выдачи подписки.
- Структура БД.
- WireGuard peer-конфиги (клиенты по-прежнему получают /32).
- Поведение существующих клиентов.

## 4) Edge-cases и ограничения
- Если все IP в /16 заняты — выбрасывается понятное исключение.
- Параллельные /start и конкуренция по IP всё ещё защищены advisory-lock.
- Старые клиенты продолжают работать, потому что их IP остаются валидными в расширенной сети.
- При достижении верхнего лимита /16 сервис не падает, а явно сообщает об отсутствии свободных IP.


## 5) Внешние действия (НЕ В КОДЕ)
- Расширение /24 → /16 выполняется вручную в wg0.conf на хосте и не входит в изменения репозитория.
